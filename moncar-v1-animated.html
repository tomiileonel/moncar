<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MONCAR ‚Äî Sistema de Registro</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#0a0a0a; --surface:#111111; --surface2:#1a1a1a;
    --border:#2a2a2a; --border2:#3a3a3a;
    --accent:#e8b84b; --accent2:#f5ca5a; --accent-glow:rgba(232,184,75,0.2);
    --text:#f0ede8; --muted:#666;
    --danger:#e85b4b; --success:#4be87a;
    --radius:12px; --radius-sm:8px;
  }
  *,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
  body { background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; min-height:100vh; overflow-x:hidden; line-height:1.6; }
  ::-webkit-scrollbar { width:5px; } ::-webkit-scrollbar-track { background:var(--bg); } ::-webkit-scrollbar-thumb { background:var(--border2); border-radius:3px; }
  .hidden { display:none !important; }

  /* NOISE + MESH */
  .mesh-bg {
    background:
      radial-gradient(ellipse 80% 60% at 50% -5%,rgba(232,184,75,.12) 0%,transparent 70%),
      radial-gradient(ellipse 55% 40% at 90% 85%,rgba(232,184,75,.05) 0%,transparent 60%),
      var(--bg);
  }
  .noise-overlay { pointer-events:none; position:fixed; inset:0; z-index:9999; opacity:.32;
    background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.08'/%3E%3C/svg%3E"); }
  .glass { background:rgba(17,17,17,.82); backdrop-filter:blur(22px); -webkit-backdrop-filter:blur(22px); border:1px solid var(--border); }

  /* ‚îÄ‚îÄ‚îÄ KEYFRAMES (V1 originals + V2 additions) ‚îÄ‚îÄ‚îÄ */
  @keyframes fadeUp    { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
  @keyframes fadeIn    { from{opacity:0} to{opacity:1} }
  @keyframes slideIn   { from{opacity:0;transform:translateX(44px)} to{opacity:1;transform:translateX(0)} }
  @keyframes toastIn   { from{opacity:0;transform:translateY(16px) scale(.95)} to{opacity:1;transform:translateY(0) scale(1)} }
  @keyframes toastOut  { from{opacity:1;transform:translateY(0) scale(1)} to{opacity:0;transform:translateY(-10px) scale(.95)} }
  @keyframes spin      { to{transform:rotate(360deg)} }
  @keyframes shake     { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
  @keyframes pulseRing { 0%{transform:scale(1);opacity:.6} 100%{transform:scale(1.65);opacity:0} }
  @keyframes glowPop   { 0%,100%{box-shadow:0 0 0 0 var(--accent-glow)} 50%{box-shadow:0 0 0 10px transparent} }

  /* ‚îÄ‚îÄ‚îÄ V2 ADDITION: barGrow ‚îÄ‚îÄ‚îÄ */
  @keyframes barGrow   { from{transform:scaleY(0)} to{transform:scaleY(1)} }

  .anim-up    { animation:fadeUp .5s ease forwards; }
  .anim-in    { animation:fadeIn .4s ease forwards; }
  .anim-slide { animation:slideIn .38s cubic-bezier(.34,1.2,.64,1) forwards; }
  .shake-el   { animation:shake .4s ease; }

  /* LANDING */
  #landing { min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; overflow:hidden; }
  .logo-big { font-family:'Bebas Neue',sans-serif; font-size:clamp(72px,12vw,140px); letter-spacing:.05em; color:var(--accent); line-height:1; }
  .logo-big span { color:var(--text); }
  .tagline { font-size:13px; letter-spacing:.3em; text-transform:uppercase; color:var(--muted); margin-top:8px; margin-bottom:56px; }
  .landing-buttons { display:flex; gap:16px; flex-wrap:wrap; justify-content:center; }

  /* BUTTONS */
  .btn { padding:14px 36px; font-family:'DM Sans',sans-serif; font-size:14px; font-weight:600; letter-spacing:.08em; text-transform:uppercase; border:none; cursor:pointer; transition:all .2s; border-radius:2px; position:relative; overflow:hidden; }
  .btn::after { content:''; position:absolute; inset:0; background:rgba(255,255,255,.1); opacity:0; transition:opacity .15s; }
  .btn:active::after { opacity:1; }
  .btn-primary { background:var(--accent); color:#0a0a0a; }
  .btn-primary:hover { background:var(--accent2); transform:translateY(-2px); box-shadow:0 8px 24px rgba(232,184,75,.35); }
  .btn-primary:active { transform:translateY(0); box-shadow:none; }
  .btn-primary:disabled { opacity:.65; cursor:not-allowed; transform:none; box-shadow:none; }
  .btn-outline { background:transparent; color:var(--text); border:1.5px solid var(--border); }
  .btn-outline:hover { border-color:var(--accent); color:var(--accent); background:var(--accent-glow); }
  .btn-sm { padding:8px 18px; font-size:12px; }
  .btn-ghost { background:var(--surface2); color:var(--muted); border:1px solid var(--border); border-radius:var(--radius-sm); padding:10px 20px; font-size:14px; cursor:pointer; transition:all .2s; }
  .btn-ghost:hover { border-color:var(--accent); color:var(--accent2); background:var(--accent-glow); }
  .btn-danger { background:rgba(232,91,75,.12); color:var(--danger); border:1px solid rgba(232,91,75,.3); border-radius:var(--radius-sm); padding:10px 18px; font-size:13px; cursor:pointer; transition:all .2s; }
  .btn-danger:hover { background:rgba(232,91,75,.22); }

  /* PANEL */
  .panel { max-width:500px; width:90%; margin:0 auto; padding:48px 40px; background:var(--surface); border:1px solid var(--border); position:relative; border-radius:var(--radius); }
  .panel::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:var(--accent); border-radius:var(--radius) var(--radius) 0 0; }
  .panel-title { font-family:'Bebas Neue',sans-serif; font-size:32px; letter-spacing:.06em; color:var(--accent); margin-bottom:4px; }
  .panel-sub { font-size:13px; color:var(--muted); margin-bottom:32px; }

  /* FORMS */
  .form-group { margin-bottom:20px; }
  label { display:block; font-size:11px; font-weight:700; letter-spacing:.15em; text-transform:uppercase; color:var(--muted); margin-bottom:8px; }
  input, select, textarea {
    width:100%; background:var(--bg); border:1px solid var(--border); color:var(--text);
    padding:12px 16px; font-family:'DM Sans',sans-serif; font-size:14px;
    border-radius:var(--radius-sm); outline:none; transition:border-color .2s, box-shadow .2s;
    appearance:none; -webkit-appearance:none; color-scheme:dark;
  }
  input:focus, select:focus, textarea:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--accent-glow); }
  input::placeholder, textarea::placeholder { color:#444; }
  select { background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23666' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 14px center; padding-right:36px; cursor:pointer; }
  select option { background:var(--bg); color:var(--text); }
  textarea { resize:vertical; min-height:90px; }
  .form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .form-actions { display:flex; gap:12px; margin-top:28px; flex-wrap:wrap; }
  .field-error { color:var(--danger); font-size:11px; margin-top:5px; display:none; }
  .field-error.show { display:block; animation:fadeUp .2s ease; }

  /* SCREENS */
  .screen { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px 20px; }

  /* STEP BAR */
  .step-bar { flex:1; height:1px; background:var(--border); transition:background .3s ease; margin:0 12px; }
  .step-bar.done { background:var(--accent); }
  .step-dot { width:34px; height:34px; border-radius:50%; background:var(--surface); border:2px solid var(--border); display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue'; font-weight:700; font-size:13px; color:var(--muted); transition:all .3s; flex-shrink:0; }
  .step-dot.active { background:var(--accent); border-color:var(--accent); color:#0a0a0a; box-shadow:0 0 14px var(--accent-glow); }

  /* VEHICLE TYPE CARDS */
  .vehicle-card { flex:1; background:var(--surface2); border:2px solid var(--border); border-radius:var(--radius); padding:18px 12px; cursor:pointer; transition:all .2s; text-align:center; min-width:0; }
  .vehicle-card:hover { border-color:var(--accent); background:var(--surface); transform:translateY(-2px); }
  .vehicle-card.selected { border-color:var(--accent); background:rgba(232,184,75,.08); box-shadow:0 0 0 1px var(--accent), 0 0 20px var(--accent-glow); animation:glowPop .5s ease; }

  /* TOPBAR */
  #dashboard { min-height:100vh; display:flex; flex-direction:column; }
  .topbar { display:flex; align-items:center; justify-content:space-between; padding:0 32px; background:rgba(10,10,10,.92); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-bottom:1px solid var(--border); height:60px; position:sticky; top:0; z-index:100; }
  .topbar-logo { font-family:'Bebas Neue'; font-size:24px; letter-spacing:.08em; color:var(--accent); }
  .topbar-logo span { color:var(--text); }
  .topbar-right { display:flex; align-items:center; gap:16px; }
  .avatar { width:34px; height:34px; border-radius:50%; background:linear-gradient(135deg,var(--accent),#c9a03a); display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue'; font-weight:700; color:#0a0a0a; font-size:15px; flex-shrink:0; }
  .online-dot { width:7px; height:7px; border-radius:50%; background:var(--success); display:inline-block; }

  /* DASH */
  .dash-body { flex:1; padding:32px; max-width:1280px; width:100%; margin:0 auto; }
  .dash-header { margin-bottom:24px; }
  .dash-header h1 { font-family:'Bebas Neue'; font-size:40px; letter-spacing:.02em; }
  .dash-header h1 span { color:var(--accent); }
  .dash-header p { color:var(--muted); font-size:13px; margin-top:4px; }

  /* STATS */
  .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(175px,1fr)); gap:14px; margin-bottom:24px; }
  .stat-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:20px 22px; position:relative; overflow:hidden; transition:transform .2s,box-shadow .2s; }
  .stat-card:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.3); }
  .stat-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--card-accent,var(--accent)),transparent); }
  .stat-val { font-family:'Bebas Neue'; font-size:32px; color:var(--accent); line-height:1; }
  .stat-label { font-size:10px; font-weight:700; letter-spacing:.15em; text-transform:uppercase; color:var(--muted); margin-top:4px; }
  .stat-icon { width:38px; height:38px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:16px; }

  /* SECTION CARD */
  .section-card { background:var(--surface); border:1px solid var(--border); padding:28px; margin-bottom:24px; position:relative; border-radius:var(--radius); }
  .section-card::before { content:''; position:absolute; top:0; left:0; width:3px; height:100%; background:var(--accent); border-radius:var(--radius) 0 0 var(--radius); }
  .section-title { font-family:'Bebas Neue'; font-size:20px; letter-spacing:.1em; color:var(--accent); margin-bottom:22px; padding-left:14px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; }

  /* ‚îÄ‚îÄ‚îÄ BILLING ‚îÄ‚îÄ‚îÄ */
  .billing-grid { display:grid; grid-template-columns:1fr 1fr; gap:24px; }

  /* ‚îÄ‚îÄ‚îÄ V2-style custom bar chart ‚îÄ‚îÄ‚îÄ */
  .billing-chart-wrap { height:220px; }
  .bar-chart-container {
    display:flex; align-items:flex-end; gap:8px;
    height:calc(100% - 24px); padding:0 2px;
  }
  .bar-col {
    flex:1; display:flex; flex-direction:column;
    align-items:center; height:100%; justify-content:flex-end; gap:6px;
  }
  .bar-fill {
    width:100%; border-radius:3px 3px 0 0;
    transform-origin:bottom;
    /* V2 barGrow animation applied per-bar via inline style */
    animation:barGrow .55s cubic-bezier(.34,1.2,.64,1) both;
    transition:height .4s ease, background .2s;
    min-height:3px;
  }
  .bar-fill:hover { filter:brightness(1.25); }
  .bar-label {
    font-size:10px; color:var(--muted);
    white-space:nowrap; text-align:center;
  }
  .bar-chart-yaxis {
    position:absolute; left:0; top:0; bottom:24px;
    display:flex; flex-direction:column; justify-content:space-between;
    pointer-events:none;
  }
  .bar-chart-yaxis span { font-size:9px; color:var(--muted); }

  .billing-info { display:flex; flex-direction:column; justify-content:center; gap:14px; }
  .billing-stat { background:var(--bg); border:1px solid var(--border); border-radius:var(--radius-sm); padding:16px 20px; transition:border-color .2s; }
  .billing-stat:hover { border-color:var(--accent); }
  .billing-stat .lbl { font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; color:var(--muted); margin-bottom:6px; }
  .billing-stat .val { font-family:'Bebas Neue'; font-size:26px; color:var(--accent); }
  .billing-stat .val.green { color:var(--success); }

  /* TABLE */
  .table-wrap { overflow-x:auto; }
  table { width:100%; border-collapse:collapse; font-size:13px; }
  th { text-align:left; font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; color:var(--muted); padding:10px 14px; border-bottom:1px solid var(--border); white-space:nowrap; }
  td { padding:13px 14px; border-bottom:1px solid rgba(255,255,255,.04); vertical-align:middle; color:var(--text); }
  tbody tr { cursor:pointer; transition:background .15s; }
  tbody tr:hover td { background:var(--surface2); }
  tbody tr:last-child td { border-bottom:none; }
  .td-mono { font-family:'DM Mono',monospace; font-size:12px; }

  /* BADGE */
  .badge { display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:100px; font-size:11px; font-weight:700; letter-spacing:.04em; text-transform:uppercase; }

  /* OVERLAY + DRAWER */
  .overlay { position:fixed; inset:0; background:rgba(0,0,0,.72); backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); z-index:100; animation:fadeIn .2s ease; }
  .drawer { position:fixed; right:0; top:0; bottom:0; width:min(420px,100vw); z-index:101; overflow-y:auto; animation:slideIn .35s cubic-bezier(.34,1.2,.64,1); background:var(--surface); border-left:1px solid var(--border); border-top:2px solid var(--accent); }
  .drawer-close { position:absolute; top:16px; right:16px; background:none; border:none; color:var(--muted); font-size:20px; cursor:pointer; transition:color .2s; }
  .drawer-close:hover { color:var(--text); }
  .drawer-title { font-family:'Bebas Neue'; font-size:22px; letter-spacing:.06em; color:var(--accent); margin-bottom:22px; }
  .detail-row { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,.05); font-size:13px; }
  .detail-row .k { color:var(--muted); font-size:11px; letter-spacing:.1em; text-transform:uppercase; }
  .detail-row .v { color:var(--text); font-weight:500; text-align:right; max-width:60%; }

  /* METRIC PILLS */
  .metric-pills { display:flex; gap:10px; }
  .metric-pill { flex:1; background:var(--bg); border:1px solid var(--border); border-radius:10px; padding:12px 14px; transition:border-color .2s; }
  .metric-pill.gold { background:rgba(232,184,75,.06); border-color:rgba(232,184,75,.25); }
  .metric-pill .lbl { font-size:10px; font-weight:700; color:var(--muted); letter-spacing:.07em; text-transform:uppercase; margin-bottom:4px; }
  .metric-pill .num { font-family:'Bebas Neue'; font-size:20px; color:var(--text); }
  .metric-pill.gold .num { color:var(--accent); }

  /* MODAL */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.8); display:flex; align-items:center; justify-content:center; z-index:999; padding:20px; animation:fadeIn .2s ease; }
  .modal { background:var(--surface); border:1px solid var(--border); border-top:2px solid var(--accent); padding:36px; width:100%; max-width:600px; max-height:90vh; overflow-y:auto; position:relative; border-radius:var(--radius); animation:fadeUp .35s cubic-bezier(.34,1.56,.64,1); }
  .modal-title { font-family:'Bebas Neue'; font-size:24px; letter-spacing:.06em; color:var(--accent); margin-bottom:22px; }
  .modal-close { position:absolute; top:16px; right:16px; background:none; border:none; color:var(--muted); font-size:20px; cursor:pointer; transition:color .2s; }
  .modal-close:hover { color:var(--text); }

  /* TOAST */
  .toast { position:fixed; bottom:28px; right:28px; z-index:9998; background:var(--surface); border:1px solid var(--success); border-radius:var(--radius); padding:14px 20px; display:flex; align-items:center; gap:12px; box-shadow:0 16px 48px rgba(0,0,0,.5),0 0 20px rgba(75,232,122,.12); min-width:280px; animation:toastIn .35s cubic-bezier(.34,1.56,.64,1) forwards; }
  .toast.out { animation:toastOut .3s ease forwards; }
  .toast-icon { width:30px; height:30px; border-radius:50%; background:rgba(75,232,122,.12); border:1px solid var(--success); display:flex; align-items:center; justify-content:center; color:var(--success); font-weight:700; font-size:13px; flex-shrink:0; }
  .toast-icon.err { background:rgba(232,91,75,.12); border-color:var(--danger); color:var(--danger); }

  /* SPINNER */
  .spinner { width:15px; height:15px; border:2px solid rgba(0,0,0,.2); border-top-color:#0a0a0a; border-radius:50%; animation:spin 1s linear infinite; display:inline-block; vertical-align:middle; margin-right:7px; }

  /* AUTH TABS */
  .auth-tab-bar { display:flex; gap:0; background:var(--bg); border-radius:10px; padding:4px; margin-bottom:24px; }
  .auth-tab { flex:1; padding:9px; border-radius:8px; border:none; background:transparent; color:var(--muted); font-family:'Bebas Neue'; font-weight:600; font-size:13px; cursor:pointer; transition:all .2s; letter-spacing:.05em; }
  .auth-tab.active { background:var(--surface); color:var(--text); box-shadow:0 2px 8px rgba(0,0,0,.3); }

  /* FILTER TABS */
  .tab-btn { padding:7px 16px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--muted); font-size:13px; font-weight:500; cursor:pointer; transition:all .2s; }
  .tab-btn.active { border-color:var(--accent); background:rgba(232,184,75,.12); color:var(--accent2); }
  .tab-btn:not(.active):hover { border-color:var(--border2); color:var(--text); }

  /* ALERT */
  .alert { padding:12px 16px; font-size:13px; border-radius:var(--radius-sm); margin-bottom:20px; animation:fadeUp .3s ease; }
  .alert-error   { background:rgba(232,91,75,.1); border:1px solid rgba(232,91,75,.3); color:#f08070; }
  .alert-success { background:rgba(75,232,122,.1); border:1px solid rgba(75,232,122,.3); color:var(--success); }

  /* EMPTY */
  .empty { text-align:center; padding:60px 20px; color:var(--muted); }
  .empty-icon { font-size:38px; margin-bottom:12px; opacity:.25; }

  /* PULSE RING */
  .pulse-ring { position:relative; display:inline-flex; align-items:center; justify-content:center; }
  .pulse-ring::before, .pulse-ring::after {
    content:''; position:absolute; border-radius:50%;
    border:2px solid var(--success); animation:pulseRing 2s ease-out infinite;
  }
  .pulse-ring::after { animation-delay:.7s; }

  @media(max-width:700px) {
    .topbar { padding:0 16px; } .dash-body { padding:20px 16px; }
    .section-card { padding:20px 16px; } .modal { padding:24px 16px; }
    .panel { padding:32px 20px; } .billing-grid { grid-template-columns:1fr; }
    .form-row { grid-template-columns:1fr; } .drawer { width:100%; }
  }
</style>
</head>
<body>

<div class="noise-overlay"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LANDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="landing" class="mesh-bg">
  <div class="logo-big anim-up" style="animation-delay:.05s">MON<span>CAR</span></div>
  <p class="tagline anim-up" style="animation-delay:.15s;opacity:0">Sistema de Registro de Veh√≠culos</p>
  <div class="landing-buttons anim-up" style="animation-delay:.25s;opacity:0">
    <button class="btn btn-primary" onclick="showScreen('screen-client-register')">Soy Cliente</button>
    <button class="btn btn-outline" onclick="showScreen('screen-admin-login')">Acceso Administrador</button>
  </div>
  <div style="position:absolute;bottom:28px;right:28px" class="anim-in" style="animation-delay:.5s">
    <div style="display:flex;align-items:center;gap:8px">
      <span class="online-dot"></span>
      <span style="font-size:11px;color:var(--muted);letter-spacing:.05em">SISTEMA EN L√çNEA</span>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLIENT REGISTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-client-register" class="screen mesh-bg hidden" style="flex-direction:column">
  <div style="position:fixed;top:0;left:0;right:0;z-index:50;background:rgba(10,10,10,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 28px;display:flex;align-items:center;height:60px;justify-content:space-between">
    <div style="font-family:'Bebas Neue';font-size:22px;color:var(--accent)">MON<span style="color:var(--text)">CAR</span></div>
    <div style="display:flex;align-items:center;gap:8px"><span class="online-dot"></span><span style="font-size:11px;color:var(--muted)">Portal de Clientes</span></div>
  </div>

  <div style="width:100%;max-width:540px;padding:80px 24px 60px;margin:0 auto">
    <div style="text-align:center;margin-bottom:28px" class="anim-up">
      <div style="display:inline-block;background:rgba(232,184,75,.1);border:1px solid rgba(232,184,75,.3);border-radius:100px;padding:5px 16px;font-size:11px;font-weight:700;letter-spacing:.1em;color:var(--accent2);text-transform:uppercase;margin-bottom:16px">Portal de Clientes</div>
      <h1 style="font-family:'Bebas Neue';font-size:clamp(28px,5vw,44px);letter-spacing:-.01em;line-height:1.1;margin-bottom:8px">Ingres√° tu veh√≠culo<br><span style="color:var(--accent)">al sistema</span></h1>
      <p style="color:var(--muted);font-size:14px">Gesti√≥n transparente y precisa.</p>
    </div>

    <!-- Step indicator -->
    <div style="display:flex;align-items:center;max-width:360px;margin:0 auto 28px;padding:0 24px">
      <div style="display:flex;align-items:center;gap:8px;flex-shrink:0">
        <div class="step-dot active" id="step-dot-1">1</div>
        <span style="font-size:13px;color:var(--text);font-weight:500" id="step-lbl-1">Tus datos</span>
      </div>
      <div class="step-bar" id="step-bar-1"></div>
      <div style="display:flex;align-items:center;gap:8px;flex-shrink:0">
        <div class="step-dot" id="step-dot-2">2</div>
        <span style="font-size:13px;color:var(--muted);font-weight:500" id="step-lbl-2">Tu veh√≠culo</span>
      </div>
    </div>

    <!-- Glass card -->
    <div class="glass anim-up" style="border-radius:20px;padding:36px;box-shadow:0 32px 80px rgba(0,0,0,.4);animation-delay:.12s">

      <!-- STEP 1 -->
      <div id="c-step1">
        <h2 style="font-family:'Bebas Neue';font-size:22px;margin-bottom:4px">Informaci√≥n personal</h2>
        <p style="color:var(--muted);font-size:13px;margin-bottom:24px">¬øC√≥mo te llamamos y a qu√© n√∫mero te contactamos?</p>
        <div class="form-group">
          <label>Nombre completo</label>
          <input type="text" id="c-name" placeholder="Ej. Juan Rodr√≠guez">
          <div class="field-error" id="c-name-err"></div>
        </div>
        <div class="form-group">
          <label>N√∫mero de tel√©fono</label>
          <input type="tel" id="c-phone" placeholder="Ej. 11 4522 3344">
          <div class="field-error" id="c-phone-err"></div>
        </div>
        <button class="btn btn-primary" style="width:100%;margin-top:8px" onclick="clientStep1()">Continuar ‚Üí</button>
        <div style="text-align:center;margin-top:14px"><button style="background:none;border:none;color:var(--muted);font-size:12px;cursor:pointer;transition:color .2s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'" onclick="showLanding()">‚Üê Volver al inicio</button></div>
      </div>

      <!-- STEP 2 -->
      <div id="c-step2" class="hidden">
        <h2 style="font-family:'Bebas Neue';font-size:22px;margin-bottom:4px">Datos del veh√≠culo</h2>
        <p style="color:var(--muted);font-size:13px;margin-bottom:24px">Contanos qu√© veh√≠culo y qu√© problema presenta.</p>

        <div class="form-group">
          <label>Tipo de veh√≠culo</label>
          <div style="display:flex;gap:10px" id="c-type-cards">
            <div class="vehicle-card" data-type="Auto" onclick="selectType(this,'c')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="28" height="19" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22 L8 14 L15 10 L33 10 L40 14 L44 22 L44 26 L4 26 Z"/><path d="M15 10 L18 6 L30 6 L33 10"/><circle cx="13" cy="26" r="4"/><circle cx="35" cy="26" r="4"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Auto</div></div>
            <div class="vehicle-card" data-type="Camioneta" onclick="selectType(this,'c')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="28" height="19" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22 L6 12 L14 7 L34 7 L42 12 L44 22 L44 26 L4 26 Z"/><path d="M14 7 L14 22 M34 7 L34 22"/><circle cx="13" cy="26" r="4.5"/><circle cx="35" cy="26" r="4.5"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Camioneta</div></div>
            <div class="vehicle-card" data-type="Cami√≥n" onclick="selectType(this,'c')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="28" height="19" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="8" width="20" height="18" rx="1"/><rect x="22" y="14" width="24" height="12" rx="1"/><path d="M22 14 L30 8 L46 8 L46 14"/><circle cx="11" cy="26" r="3.5"/><circle cx="37" cy="26" r="3.5"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Cami√≥n</div></div>
          </div>
          <div class="field-error" id="c-type-err"></div>
        </div>

        <div class="form-row">
          <div class="form-group"><label>Marca</label><select id="c-carname"></select><div class="field-error" id="c-brand-err"></div></div>
          <div class="form-group"><label>A√±o</label><select id="c-model"></select><div class="field-error" id="c-year-err"></div></div>
        </div>
        <div class="form-group"><label>Fecha de ingreso</label><input type="date" id="c-entry"><div class="field-error" id="c-entry-err"></div></div>
        <div class="form-group"><label>Problema / motivo de visita</label><textarea id="c-problem" placeholder="Describ√≠ con detalle el problema, s√≠ntomas, ruidos u otros indicios‚Ä¶"></textarea><div class="field-error" id="c-problem-err"></div></div>

        <div class="form-actions">
          <button class="btn-ghost" onclick="goStep1()">‚Üê Volver</button>
          <button class="btn btn-primary" style="flex:1" id="c-submit-btn" onclick="registerClient()">Registrar veh√≠culo ‚úì</button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-admin-login" class="screen mesh-bg hidden">
  <div style="width:100%;max-width:420px">
    <div style="text-align:center;margin-bottom:40px" class="anim-up">
      <div style="font-family:'Bebas Neue';font-size:36px;color:var(--accent)">MON<span style="color:var(--text)">CAR</span></div>
      <div style="font-size:10px;color:var(--muted);letter-spacing:.15em;text-transform:uppercase;margin-top:2px">Gesti√≥n Premium</div>
    </div>

    <div class="glass anim-up" style="border-radius:20px;padding:40px 38px;box-shadow:0 40px 100px rgba(0,0,0,.5);animation-delay:.1s" id="auth-card">
      <div style="text-align:center;margin-bottom:24px">
        <div style="width:54px;height:54px;border-radius:50%;background:rgba(232,184,75,.1);border:1px solid rgba(232,184,75,.3);display:flex;align-items:center;justify-content:center;margin:0 auto 12px;box-shadow:0 0 28px var(--accent-glow)">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        </div>
        <h2 style="font-family:'Bebas Neue';font-size:22px;margin-bottom:4px" id="auth-title">Acceso Administrativo</h2>
        <p style="color:var(--muted);font-size:12px" id="auth-sub">Panel de control exclusivo</p>
      </div>

      <div class="auth-tab-bar">
        <button class="auth-tab active" id="tab-signup" onclick="switchAuthTab('signup')">Registrarse</button>
        <button class="auth-tab" id="tab-login" onclick="switchAuthTab('login')">Iniciar Sesi√≥n</button>
      </div>
      <div id="auth-alert"></div>

      <!-- SIGNUP -->
      <div id="auth-signup">
        <div class="form-group"><label>Nombre completo</label><input type="text" id="as-name" placeholder="Tu nombre"><div class="field-error" id="as-name-err"></div></div>
        <div class="form-group"><label>Correo electr√≥nico</label><input type="email" id="as-email" placeholder="admin@moncar.com"><div class="field-error" id="as-email-err"></div></div>
        <div class="form-group"><label>Contrase√±a pre-establecida</label><input type="password" id="as-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><div class="field-error" id="as-pass-err"></div></div>
        <button class="btn btn-primary" style="width:100%;margin-top:8px" id="signup-btn" onclick="adminSignup()">Crear cuenta</button>
      </div>
      <!-- LOGIN -->
      <div id="auth-login" class="hidden">
        <div class="form-group"><label>Correo electr√≥nico</label><input type="email" id="al-email" placeholder="admin@moncar.com"><div class="field-error" id="al-email-err"></div></div>
        <div class="form-group"><label>Contrase√±a</label><input type="password" id="al-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')adminLogin()"><div class="field-error" id="al-pass-err"></div></div>
        <button class="btn btn-primary" style="width:100%;margin-top:8px" id="login-btn" onclick="adminLogin()">Ingresar al Panel</button>
      </div>

      <div style="text-align:center;margin-top:16px"><button style="background:none;border:none;color:var(--muted);font-size:12px;cursor:pointer;transition:color .2s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'" onclick="showLanding()">‚Üê Volver al inicio</button></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLIENT SUCCESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-client-success" class="screen mesh-bg hidden">
  <div style="text-align:center;max-width:440px" class="anim-up">
    <div class="pulse-ring" style="margin:0 auto 24px;width:76px;height:76px">
      <div style="width:76px;height:76px;border-radius:50%;background:rgba(75,232,122,.1);border:2px solid var(--success);display:flex;align-items:center;justify-content:center;font-size:30px;color:var(--success);box-shadow:0 0 36px rgba(75,232,122,.2)">‚úì</div>
    </div>
    <h2 style="font-family:'Bebas Neue';font-size:40px;letter-spacing:.02em;margin-bottom:10px">¬°Registro exitoso!</h2>
    <p style="color:var(--muted);font-size:15px;line-height:1.7;margin-bottom:32px">Tu veh√≠culo fue ingresado al sistema MONCAR. Nuestro equipo t√©cnico lo revisar√° y te contactaremos a la brevedad.</p>
    <button class="btn btn-primary" style="padding:13px 34px" onclick="showLanding()">Registrar otro veh√≠culo</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="dashboard" class="hidden">
  <div class="topbar">
    <div class="topbar-logo">MON<span>CAR</span></div>
    <div class="topbar-right">
      <div style="text-align:right">
        <div style="font-size:13px;font-weight:600" id="dash-username"></div>
        <div style="font-size:11px;color:var(--muted)">Administrador</div>
      </div>
      <div class="avatar" id="dash-avatar">A</div>
      <button class="btn btn-outline btn-sm" onclick="adminLogout()">Salir</button>
    </div>
  </div>

  <div class="dash-body">
    <div class="dash-header anim-up">
      <h1>Panel de <span>Control</span></h1>
      <p id="dash-date"></p>
    </div>
    <div style="display:flex;justify-content:flex-end;margin-bottom:20px;animation:fadeUp .5s ease .06s both">
      <button class="btn btn-primary" style="padding:11px 22px;font-size:13px" onclick="scrollToReg()">+ Nuevo registro</button>
    </div>

    <!-- STATS -->
    <div class="stats" id="stats-row" style="animation:fadeUp .5s ease .09s both"></div>

    <!-- BILLING -->
    <div class="section-card" style="animation:fadeUp .5s ease .15s both">
      <div class="section-title">Facturaci√≥n</div>
      <div class="billing-grid">
        <div>
          <div style="font-size:10px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:12px">Historial mensual (√∫ltimos 6 meses)</div>
          <div class="billing-chart-wrap" id="billing-chart-wrap"></div>
        </div>
        <div class="billing-info">
          <div class="billing-stat"><div class="lbl">Ingresos este mes</div><div class="val" id="billing-current">$ 0</div></div>
          <div class="billing-stat"><div class="lbl">Ingresos mes anterior</div><div class="val green" id="billing-prev">$ 0</div></div>
        </div>
      </div>
    </div>

    <!-- REGISTER -->
    <div class="section-card" id="admin-reg-section" style="animation:fadeUp .5s ease .2s both">
      <div class="section-title">Registrar Veh√≠culo</div>
      <div id="admin-reg-alert"></div>
      <div class="form-row">
        <div class="form-group"><label>Propietario</label><input type="text" id="a-owner" placeholder="Nombre del cliente"></div>
        <div class="form-group"><label>Tel√©fono</label><input type="tel" id="a-phone" placeholder="11 4522 3344"></div>
      </div>
      <div class="form-group">
        <label>Tipo de veh√≠culo</label>
        <div style="display:flex;gap:10px" id="a-type-cards">
          <div class="vehicle-card" data-type="Auto" onclick="selectType(this,'a')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="26" height="17" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22 L8 14 L15 10 L33 10 L40 14 L44 22 L44 26 L4 26 Z"/><path d="M15 10 L18 6 L30 6 L33 10"/><circle cx="13" cy="26" r="4"/><circle cx="35" cy="26" r="4"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Auto</div></div>
          <div class="vehicle-card" data-type="Camioneta" onclick="selectType(this,'a')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="26" height="17" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22 L6 12 L14 7 L34 7 L42 12 L44 22 L44 26 L4 26 Z"/><path d="M14 7 L14 22 M34 7 L34 22"/><circle cx="13" cy="26" r="4.5"/><circle cx="35" cy="26" r="4.5"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Camioneta</div></div>
          <div class="vehicle-card" data-type="Cami√≥n" onclick="selectType(this,'a')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="26" height="17" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="8" width="20" height="18" rx="1"/><rect x="22" y="14" width="24" height="12" rx="1"/><path d="M22 14 L30 8 L46 8 L46 14"/><circle cx="11" cy="26" r="3.5"/><circle cx="37" cy="26" r="3.5"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Cami√≥n</div></div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Marca</label><select id="a-carname"></select></div>
        <div class="form-group"><label>A√±o</label><select id="a-model"></select></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Fecha de ingreso</label><input type="date" id="a-entry"></div>
        <div class="form-group"><label>Fecha de salida</label><input type="date" id="a-exit"></div>
      </div>
      <div class="form-group"><label>Problema / Descripci√≥n</label><textarea id="a-problem" placeholder="Describ√≠ el problema del veh√≠culo‚Ä¶"></textarea></div>
      <div class="form-row">
        <div class="form-group"><label>Monto de reparaci√≥n (ARS $)</label><input type="number" id="a-cost" placeholder="0" step="1"></div>
        <div class="form-group"><label>Kil√≥metros</label><input type="number" id="a-km" placeholder="45000"></div>
      </div>
      <div class="form-group"><label>Estado</label><select id="a-status"><option value="Pendiente">Pendiente</option><option value="En reparaci√≥n">En reparaci√≥n</option><option value="Listo">Listo</option></select></div>
      <div class="form-actions">
        <button class="btn btn-primary" id="a-submit-btn" onclick="adminAddVehicle()">Registrar veh√≠culo ‚úì</button>
      </div>
    </div>

    <!-- TABLE -->
    <div class="section-card" style="animation:fadeUp .5s ease .25s both">
      <div class="section-title">
        <span>Veh√≠culos Registrados</span>
        <input type="text" id="search-box" placeholder="üîç  Buscar‚Ä¶" style="width:220px;padding:9px 14px;font-size:13px;letter-spacing:0;font-weight:400;font-family:'DM Sans'" oninput="renderTable()">
      </div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px" id="filter-tabs">
        <button class="tab-btn active" data-filter="todos" onclick="setFilter(this)">Todos <span id="ft-todos" style="opacity:.6">(0)</span></button>
        <button class="tab-btn" data-filter="Pendiente" onclick="setFilter(this)">Pendientes <span id="ft-pend" style="opacity:.6">(0)</span></button>
        <button class="tab-btn" data-filter="En reparaci√≥n" onclick="setFilter(this)">En reparaci√≥n <span id="ft-enrep" style="opacity:.6">(0)</span></button>
        <button class="tab-btn" data-filter="Listo" onclick="setFilter(this)">Completados <span id="ft-listo" style="opacity:.6">(0)</span></button>
      </div>
      <div class="table-wrap" id="vehicles-table-wrap"></div>
      <p style="color:var(--muted);font-size:11px;margin-top:12px;text-align:center">Hac√© clic en cualquier registro para editarlo</p>
    </div>
  </div>
</div>

<!-- DRAWER -->
<div id="drawer-overlay" class="overlay hidden" onclick="closeDrawer()"></div>
<div id="detail-drawer" class="drawer hidden">
  <button class="drawer-close" onclick="closeDrawer()">‚úï</button>
  <div style="padding:28px">
    <div class="drawer-title" id="drawer-title"></div>
    <div id="drawer-content"></div>
    <div style="margin-top:24px"><button class="btn btn-primary" style="width:100%" id="drawer-edit-btn">Editar veh√≠culo</button></div>
  </div>
</div>

<!-- EDIT MODAL -->
<div id="edit-modal" class="modal-overlay hidden">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div class="modal-title">Editar Veh√≠culo</div>
    <input type="hidden" id="edit-id">
    <div class="metric-pills" id="edit-pills" style="margin-bottom:20px"></div>

    <div class="form-group">
      <label>Tipo de veh√≠culo</label>
      <div style="display:flex;gap:10px" id="e-type-cards">
        <div class="vehicle-card" data-type="Auto" onclick="selectType(this,'e')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="24" height="16" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22 L8 14 L15 10 L33 10 L40 14 L44 22 L44 26 L4 26 Z"/><path d="M15 10 L18 6 L30 6 L33 10"/><circle cx="13" cy="26" r="4"/><circle cx="35" cy="26" r="4"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Auto</div></div>
        <div class="vehicle-card" data-type="Camioneta" onclick="selectType(this,'e')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="24" height="16" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22 L6 12 L14 7 L34 7 L42 12 L44 22 L44 26 L4 26 Z"/><path d="M14 7 L14 22 M34 7 L34 22"/><circle cx="13" cy="26" r="4.5"/><circle cx="35" cy="26" r="4.5"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Camioneta</div></div>
        <div class="vehicle-card" data-type="Cami√≥n" onclick="selectType(this,'e')"><div style="color:var(--muted);margin-bottom:8px;display:flex;justify-content:center"><svg width="24" height="16" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="8" width="20" height="18" rx="1"/><rect x="22" y="14" width="24" height="12" rx="1"/><path d="M22 14 L30 8 L46 8 L46 14"/><circle cx="11" cy="26" r="3.5"/><circle cx="37" cy="26" r="3.5"/></svg></div><div style="font-size:12px;font-weight:600;color:var(--muted)">Cami√≥n</div></div>
      </div>
    </div>
    <div class="form-row"><div class="form-group"><label>Propietario</label><input type="text" id="e-owner"></div><div class="form-group"><label>Tel√©fono</label><input type="tel" id="e-phone"></div></div>
    <div class="form-row"><div class="form-group"><label>Marca</label><select id="e-carname"></select></div><div class="form-group"><label>A√±o</label><select id="e-model"></select></div></div>
    <div class="form-row">
      <div class="form-group"><label>Kil√≥metros</label><input type="number" id="e-km" oninput="updateEditPills()"></div>
      <div class="form-group"><label>Monto (ARS $)</label><input type="number" id="e-cost" step="1" oninput="updateEditPills()"></div>
    </div>
    <div class="form-row"><div class="form-group"><label>Fecha de ingreso</label><input type="date" id="e-entry"></div><div class="form-group"><label>Fecha de salida</label><input type="date" id="e-exit"></div></div>
    <div class="form-group"><label>Problema</label><textarea id="e-problem"></textarea></div>
    <div class="form-group"><label>Estado</label><select id="e-status"><option value="Pendiente">Pendiente</option><option value="En reparaci√≥n">En reparaci√≥n</option><option value="Listo">Listo</option></select></div>
    <div class="form-actions" style="justify-content:space-between">
      <button class="btn-danger" onclick="deleteVehicle()">Eliminar</button>
      <div style="display:flex;gap:10px"><button class="btn-ghost" onclick="closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveEdit()">Guardar cambios</button></div>
    </div>
  </div>
</div>

<div id="toast-container"></div>

<script>
const ADMIN_PW = 'moncar1234';
const BRANDS   = ['Audi','BMW','Chevrolet','Citro√´n','Fiat','Ford','Honda','Hyundai','Jeep','Mercedes-Benz','Mitsubishi','Nissan','Peugeot','Renault','Toyota','Volkswagen','Volvo'];
const YEARS    = Array.from({length:28},(_,i)=>2026-i);
const delay    = ms => new Promise(r=>setTimeout(r,ms));

let db = JSON.parse(localStorage.getItem('mc_db3')||'{"admins":[],"vehicles":[]}');
let currentAdmin = null;
let curFilter   = 'todos';
let selType     = {c:'',a:'',e:''};

function save(){ localStorage.setItem('mc_db3',JSON.stringify(db)); }

// ‚îÄ‚îÄ SELECTS ‚îÄ‚îÄ
function populateSelects(pairs){
  pairs.forEach(([bid,yid])=>{
    const bs=document.getElementById(bid); const ys=document.getElementById(yid);
    if(bs) bs.innerHTML='<option value="">Seleccionar marca</option>'+BRANDS.map(b=>`<option>${b}</option>`).join('');
    if(ys) ys.innerHTML='<option value="">A√±o del veh√≠culo</option>'+YEARS.map(y=>`<option value="${y}">${y}</option>`).join('');
  });
}
window.addEventListener('DOMContentLoaded',()=>{
  populateSelects([['c-carname','c-model'],['a-carname','a-model'],['e-carname','e-model']]);
  document.getElementById('c-entry').value=new Date().toISOString().split('T')[0];
});

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function showLanding(){ ['screen-client-register','screen-admin-login','screen-client-success','dashboard'].forEach(hide); show('landing'); }
function showScreen(id){ ['landing','screen-client-register','screen-admin-login','screen-client-success','dashboard'].forEach(hide); show(id); }
function show(id){ document.getElementById(id).classList.remove('hidden'); }
function hide(id){ document.getElementById(id).classList.add('hidden'); }

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg,type='success'){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className='toast';
  if(type!=='success') t.style.borderColor='var(--danger)';
  t.innerHTML=`<div class="toast-icon${type!=='success'?' err':''}">${type==='success'?'‚úì':'‚úï'}</div><div><div style="font-family:'Bebas Neue';font-size:14px;color:var(--text);letter-spacing:.04em">${type==='success'?'¬°Listo!':'Error'}</div><div style="font-size:12px;color:var(--muted);margin-top:1px">${msg}</div></div>`;
  c.appendChild(t);
  setTimeout(()=>{ t.classList.add('out'); setTimeout(()=>t.remove(),350); },4000);
}

// ‚îÄ‚îÄ SHAKE ‚îÄ‚îÄ
function shake(id){ const el=document.getElementById(id); if(!el) return; el.classList.remove('shake-el'); void el.offsetWidth; el.classList.add('shake-el'); setTimeout(()=>el.classList.remove('shake-el'),500); }

// ‚îÄ‚îÄ FIELD ERRORS ‚îÄ‚îÄ
function showFErr(id,msg){ const el=document.getElementById(id); if(!el) return; el.textContent=msg; el.classList.add('show'); }
function clearFErrs(ids){ ids.forEach(id=>{ const el=document.getElementById(id); if(el){el.textContent='';el.classList.remove('show');} }); }
function setAlert(id,msg,type='error'){ const el=document.getElementById(id); if(el) el.innerHTML=msg?`<div class="alert alert-${type}">${msg}</div>`:''; }

// ‚îÄ‚îÄ VEHICLE TYPE ‚îÄ‚îÄ
function selectType(el,prefix){
  el.parentElement.querySelectorAll('.vehicle-card').forEach(c=>{
    c.classList.remove('selected');
    const icon=c.querySelector('div'); if(icon) icon.style.color='var(--muted)';
    const lbl=c.querySelectorAll('div')[1]; if(lbl) lbl.style.color='var(--muted)';
  });
  el.classList.add('selected');
  const icon=el.querySelector('div'); if(icon) icon.style.color='var(--accent)';
  const lbl=el.querySelectorAll('div')[1]; if(lbl) lbl.style.color='var(--text)';
  selType[prefix]=el.dataset.type;
}

// ‚îÄ‚îÄ CLIENT STEP 1 ‚îÄ‚îÄ
function clientStep1(){
  clearFErrs(['c-name-err','c-phone-err']);
  const name=document.getElementById('c-name').value.trim();
  const phone=document.getElementById('c-phone').value.trim();
  let ok=true;
  if(!name){ showFErr('c-name-err','El nombre es requerido'); ok=false; }
  if(!/^\d{7,15}$/.test(phone.replace(/\s/g,''))){ showFErr('c-phone-err','Tel√©fono inv√°lido (solo n√∫meros)'); ok=false; }
  if(!ok){ shake('c-step1'); return; }
  hide('c-step1'); show('c-step2');
  document.getElementById('step-dot-2').classList.add('active');
  document.getElementById('step-bar-1').classList.add('done');
  document.getElementById('step-lbl-2').style.color='var(--text)';
  document.getElementById('c-step2').style.animation='fadeUp .4s ease';
}
function goStep1(){
  show('c-step1'); hide('c-step2');
  document.getElementById('step-dot-2').classList.remove('active');
  document.getElementById('step-bar-1').classList.remove('done');
  document.getElementById('step-lbl-2').style.color='var(--muted)';
}

// ‚îÄ‚îÄ CLIENT REGISTER ‚îÄ‚îÄ
async function registerClient(){
  clearFErrs(['c-type-err','c-brand-err','c-year-err','c-entry-err','c-problem-err']);
  const type=selType.c, carname=document.getElementById('c-carname').value, model=document.getElementById('c-model').value,
        entry=document.getElementById('c-entry').value, problem=document.getElementById('c-problem').value.trim();
  let ok=true;
  if(!type){  showFErr('c-type-err','Seleccion√° el tipo'); ok=false; }
  if(!carname){ showFErr('c-brand-err','Seleccion√° la marca'); ok=false; }
  if(!model){   showFErr('c-year-err','Seleccion√° el a√±o'); ok=false; }
  if(!entry){   showFErr('c-entry-err','Ingres√° la fecha'); ok=false; }
  if(!problem){ showFErr('c-problem-err','Describ√≠ el problema'); ok=false; }
  if(!ok){ shake('c-step2'); return; }

  const btn=document.getElementById('c-submit-btn');
  btn.disabled=true; btn.innerHTML='<span class="spinner"></span>Registrando‚Ä¶';
  await delay(1100);
  db.vehicles.push({ id:Date.now().toString(), owner:document.getElementById('c-name').value.trim(), phone:document.getElementById('c-phone').value.trim(), type, carname, model, km:'', entry, exit:'', problem, cost:'', status:'Pendiente', source:'client' });
  save();
  btn.disabled=false; btn.innerHTML='Registrar veh√≠culo ‚úì';
  showScreen('screen-client-success');
}

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
function switchAuthTab(tab){
  setAlert('auth-alert','');
  if(tab==='signup'){
    show('auth-signup'); hide('auth-login');
    document.getElementById('tab-signup').classList.add('active'); document.getElementById('tab-login').classList.remove('active');
    document.getElementById('auth-title').textContent='Crear cuenta Admin'; document.getElementById('auth-sub').textContent='Solo personal autorizado';
  } else {
    hide('auth-signup'); show('auth-login');
    document.getElementById('tab-login').classList.add('active'); document.getElementById('tab-signup').classList.remove('active');
    document.getElementById('auth-title').textContent='Acceso Administrativo'; document.getElementById('auth-sub').textContent='Panel de control exclusivo';
  }
}

async function adminSignup(){
  const name=document.getElementById('as-name').value.trim(), email=document.getElementById('as-email').value.trim().toLowerCase(), pass=document.getElementById('as-pass').value;
  clearFErrs(['as-name-err','as-email-err','as-pass-err']); setAlert('auth-alert','');
  let ok=true;
  if(!name){ showFErr('as-name-err','El nombre es requerido'); ok=false; }
  if(!/\S+@\S+\.\S+/.test(email)){ showFErr('as-email-err','Correo inv√°lido'); ok=false; }
  if(pass!==ADMIN_PW){ showFErr('as-pass-err','La contrase√±a no es correcta'); ok=false; }
  if(!ok){ shake('auth-card'); return; }
  if(db.admins.find(a=>a.email===email)){ showFErr('as-email-err','Este correo ya est√° registrado'); shake('auth-card'); return; }

  const btn=document.getElementById('signup-btn');
  btn.disabled=true; btn.innerHTML='<span class="spinner"></span>Creando cuenta‚Ä¶';
  await delay(900);
  db.admins.push({name,email,pass}); save();
  btn.disabled=false; btn.innerHTML='Crear cuenta';
  setAlert('auth-alert','¬°Cuenta creada! Ahora pod√©s iniciar sesi√≥n.','success');
  setTimeout(()=>{ switchAuthTab('login'); document.getElementById('al-email').value=email; setAlert('auth-alert',''); },1800);
}

async function adminLogin(){
  const email=document.getElementById('al-email').value.trim().toLowerCase(), pass=document.getElementById('al-pass').value;
  clearFErrs(['al-email-err','al-pass-err']); setAlert('auth-alert','');
  if(!/\S+@\S+\.\S+/.test(email)){ showFErr('al-email-err','Correo inv√°lido'); return; }
  if(!pass){ showFErr('al-pass-err','La contrase√±a es requerida'); return; }

  const btn=document.getElementById('login-btn');
  btn.disabled=true; btn.innerHTML='<span class="spinner"></span>Verificando‚Ä¶';
  await delay(900);

  const admin=db.admins.find(a=>a.email===email);
  if(!admin){ btn.disabled=false; btn.innerHTML='Ingresar al Panel'; showFErr('al-email-err','No encontramos ese correo. ¬øYa te registraste?'); shake('auth-card'); return; }
  if(pass!==ADMIN_PW){ btn.disabled=false; btn.innerHTML='Ingresar al Panel'; showFErr('al-pass-err','Contrase√±a incorrecta'); shake('auth-card'); return; }

  btn.disabled=false; btn.innerHTML='Ingresar al Panel';
  currentAdmin=admin; openDashboard();
}

function adminLogout(){ currentAdmin=null; showLanding(); }

// ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
function openDashboard(){
  hide('screen-admin-login'); hide('landing'); show('dashboard');
  document.getElementById('dash-username').textContent=currentAdmin.name;
  document.getElementById('dash-avatar').textContent=currentAdmin.name.charAt(0).toUpperCase();
  document.getElementById('dash-date').textContent=new Date().toLocaleDateString('es-AR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  document.getElementById('a-entry').value=new Date().toISOString().split('T')[0];
  populateSelects([['a-carname','a-model'],['e-carname','e-model']]);
  renderStats(); renderBilling(); renderTable();
}
function scrollToReg(){ document.getElementById('admin-reg-section').scrollIntoView({behavior:'smooth'}); }

// ‚îÄ‚îÄ BILLING ‚îÄ‚îÄ
function monthKey(s){ const d=new Date(s+'T12:00:00'); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; }
function formatARS(v){ return '$ '+Math.round(v).toLocaleString('es-AR'); }
function getRevMap(){ const m={}; db.vehicles.forEach(v=>{ if(!v.cost||!v.entry) return; const k=monthKey(v.entry); m[k]=(m[k]||0)+(parseFloat(v.cost)||0); }); return m; }

// ‚îÄ‚îÄ‚îÄ V2-style animated bar chart (barGrow keyframe, per-bar stagger) ‚îÄ‚îÄ‚îÄ
function renderBilling(){
  const now=new Date();
  const ck=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  const pd=new Date(now.getFullYear(),now.getMonth()-1,1);
  const pk=`${pd.getFullYear()}-${String(pd.getMonth()+1).padStart(2,'0')}`;
  const rev=getRevMap();

  document.getElementById('billing-current').textContent=formatARS(rev[ck]||0);
  document.getElementById('billing-prev').textContent=formatARS(rev[pk]||0);

  const labels=[], values=[];
  for(let i=5;i>=0;i--){
    const d=new Date(now.getFullYear(),now.getMonth()-i,1);
    const k=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    labels.push(d.toLocaleString('es-AR',{month:'short',year:'2-digit'}));
    values.push(rev[k]||0);
  }

  const maxVal=Math.max(...values,1);
  const wrap=document.getElementById('billing-chart-wrap');

  // Build tooltip formatter
  const fmt=v=>v?formatARS(v):'Sin datos';

  wrap.innerHTML=`
    <div class="bar-chart-container">
      ${values.map((v,i)=>{
        const pct=Math.max((v/maxVal)*100, v>0?5:1.5);
        const isCurrent=i===5;
        const delay=(i*0.06).toFixed(2);
        const bg=isCurrent
          ? 'rgba(232,184,75,.9)'
          : 'rgba(232,184,75,.22)';
        const bgHover=isCurrent
          ? 'rgba(245,202,90,.95)'
          : 'rgba(232,184,75,.38)';
        return `
          <div class="bar-col" title="${labels[i]}: ${fmt(v)}">
            <div class="bar-fill"
              style="height:${pct}%;background:${bg};animation-delay:${delay}s"
              onmouseenter="this.style.background='${bgHover}'"
              onmouseleave="this.style.background='${bg}'"
            ></div>
            <span class="bar-label">${labels[i]}</span>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

// ‚îÄ‚îÄ STATS ‚îÄ‚îÄ
function renderStats(){
  const vs=db.vehicles, total=vs.length, pend=vs.filter(v=>v.status!=='Listo').length, done=vs.filter(v=>v.status==='Listo').length;
  const now=new Date(), ck=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  const mRev=vs.filter(v=>v.entry&&monthKey(v.entry)===ck).reduce((s,v)=>s+(parseFloat(v.cost)||0),0);
  document.getElementById('stats-row').innerHTML=[
    {l:'Total veh√≠culos',v:total,icon:'‚ñ§',c:'var(--accent)'},
    {l:'En proceso',v:pend,icon:'‚Üª',c:'#60a5fa'},
    {l:'Completados',v:done,icon:'‚úì',c:'var(--success)'},
    {l:`Facturado (${now.toLocaleDateString('es-AR',{month:'short'})})`,v:formatARS(mRev),icon:'‚Ç±',c:'var(--accent)',sub:'ARS este mes'},
  ].map((s,i)=>`
    <div class="stat-card" style="--card-accent:${s.c};animation:fadeUp .5s ease ${.09+i*.05}s both">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div class="stat-label">${s.l}</div>
          <div class="stat-val" style="color:${s.sub?'var(--accent)':s.c==='var(--accent)'?'var(--text)':s.c}">${s.v}</div>
          ${s.sub?`<div style="font-size:11px;color:var(--muted);margin-top:2px">${s.sub}</div>`:''}
        </div>
        <div class="stat-icon" style="background:rgba(232,184,75,.08);color:${s.c}">${s.icon}</div>
      </div>
    </div>
  `).join('');
  document.getElementById('ft-todos').textContent=`(${total})`;
  document.getElementById('ft-pend').textContent=`(${vs.filter(v=>v.status==='Pendiente').length})`;
  document.getElementById('ft-enrep').textContent=`(${vs.filter(v=>v.status==='En reparaci√≥n').length})`;
  document.getElementById('ft-listo').textContent=`(${done})`;
}

// ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ
function setFilter(btn){ document.querySelectorAll('#filter-tabs .tab-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); curFilter=btn.dataset.filter; renderTable(); }

function badgeHTML(status){
  const m={'Pendiente':{bg:'rgba(245,158,11,.12)',c:'#f59e0b',b:'rgba(245,158,11,.3)',l:'Pendiente'},'En reparaci√≥n':{bg:'rgba(96,165,250,.12)',c:'#60a5fa',b:'rgba(96,165,250,.3)',l:'En reparaci√≥n'},'Listo':{bg:'rgba(75,232,122,.12)',c:'var(--success)',b:'rgba(75,232,122,.3)',l:'Completado'}};
  const s=m[status]||m['Pendiente'];
  return `<span class="badge" style="background:${s.bg};color:${s.c};border:1px solid ${s.b}"><span style="width:5px;height:5px;border-radius:50%;background:${s.c};display:inline-block"></span>${s.l}</span>`;
}

function renderTable(){
  const q=(document.getElementById('search-box').value||'').toLowerCase();
  const vs=db.vehicles.filter(v=>{ const mf=curFilter==='todos'||v.status===curFilter; const ms=!q||[v.owner,v.carname,v.model,v.type,v.status].some(s=>(s||'').toLowerCase().includes(q)); return mf&&ms; });
  const wrap=document.getElementById('vehicles-table-wrap');
  if(!vs.length){ wrap.innerHTML=`<div class="empty"><div class="empty-icon">üöó</div><p>Sin resultados para los filtros actuales</p></div>`; return; }
  const svgFor=t=>t==='Cami√≥n'?'<rect x="2" y="8" width="20" height="18" rx="1"/><rect x="22" y="14" width="24" height="12" rx="1"/><path d="M22 14 L30 8 L46 8 L46 14"/><circle cx="11" cy="26" r="3.5"/><circle cx="37" cy="26" r="3.5"/>':t==='Camioneta'?'<path d="M4 22 L6 12 L14 7 L34 7 L42 12 L44 22 L44 26 L4 26 Z"/><path d="M14 7 L14 22 M34 7 L34 22"/><circle cx="13" cy="26" r="4.5"/><circle cx="35" cy="26" r="4.5"/>':'<path d="M4 22 L8 14 L15 10 L33 10 L40 14 L44 22 L44 26 L4 26 Z"/><path d="M15 10 L18 6 L30 6 L33 10"/><circle cx="13" cy="26" r="4"/><circle cx="35" cy="26" r="4"/>';
  wrap.innerHTML=`
    <table><thead><tr><th>Veh√≠culo</th><th>Cliente</th><th>Tipo</th><th>Ingreso</th><th>Salida</th><th>Km</th><th>Costo (ARS)</th><th>Estado</th></tr></thead>
    <tbody>${vs.map((v,i)=>`
      <tr onclick="openDrawer('${v.id}')" style="animation:fadeUp .3s ease ${i*.025}s both">
        <td><div style="display:flex;align-items:center;gap:10px"><div style="width:34px;height:34px;border-radius:8px;background:var(--bg);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;color:var(--accent);flex-shrink:0"><svg width="18" height="12" viewBox="0 0 48 32" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">${svgFor(v.type)}</svg></div><div><div style="color:var(--text);font-weight:600;font-size:13px">${v.carname||'‚Äî'}</div><div style="color:var(--muted);font-size:11px">${v.model||'‚Äî'}</div></div></div></td>
        <td><div style="font-size:13px">${v.owner}</div><div style="color:var(--muted);font-size:11px">${v.phone||'‚Äî'}</div></td>
        <td style="font-size:12px;color:var(--muted)">${v.type||'‚Äî'}</td>
        <td class="td-mono" style="font-size:12px">${v.entry||'‚Äî'}</td>
        <td class="td-mono" style="font-size:12px;color:${v.exit?'var(--success)':'var(--muted)'}">${v.exit||'Pendiente'}</td>
        <td class="td-mono" style="font-size:12px">${v.km?Number(v.km).toLocaleString('es-AR')+' km':'‚Äî'}</td>
        <td><span style="color:var(--accent);font-family:'DM Mono';font-weight:600;font-size:13px">${v.cost?formatARS(v.cost):'‚Äî'}</span></td>
        <td>${badgeHTML(v.status)}</td>
      </tr>`).join('')}
    </tbody></table>`;
}

// ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ
function openDrawer(id){
  const v=db.vehicles.find(x=>x.id===id); if(!v) return;
  document.getElementById('drawer-title').textContent=`${v.carname||'Veh√≠culo'} ${v.model||''}`;
  document.getElementById('drawer-edit-btn').onclick=()=>{ closeDrawer(); openEditById(id); };
  const row=(k,val,sty='')=>`<div class="detail-row"><span class="k">${k}</span><span class="v" ${sty}>${val||'‚Äî'}</span></div>`;
  document.getElementById('drawer-content').innerHTML=`
    <div class="metric-pills" style="margin-bottom:20px">
      <div class="metric-pill"><div class="lbl">Kilometraje</div><div class="num">${v.km?Number(v.km).toLocaleString('es-AR')+' km':'Sin registrar'}</div></div>
      <div class="metric-pill gold"><div class="lbl">Monto reparaci√≥n</div><div class="num">${v.cost?formatARS(v.cost):'Sin registrar'}</div></div>
    </div>
    ${row('Propietario',`<strong>${v.owner}</strong>`)}${row('Tel√©fono',v.phone)}${row('Tipo',v.type)}${row('Marca',v.carname)}${row('A√±o',v.model)}${row('Fecha ingreso',v.entry)}${row('Fecha salida',v.exit,'style="color:var(--success)"')}${row('Estado',v.status)}
    <div class="detail-row" style="flex-direction:column;gap:8px;border-bottom:none"><span class="k">Problema</span><span style="font-size:13px;color:var(--text);line-height:1.6;margin-top:4px">${v.problem||'‚Äî'}</span></div>`;
  show('drawer-overlay'); show('detail-drawer');
}
function closeDrawer(){ hide('drawer-overlay'); hide('detail-drawer'); }

// ‚îÄ‚îÄ ADMIN ADD ‚îÄ‚îÄ
async function adminAddVehicle(){
  const owner=document.getElementById('a-owner').value.trim(), phone=document.getElementById('a-phone').value.trim(), type=selType.a, carname=document.getElementById('a-carname').value, model=document.getElementById('a-model').value;
  setAlert('admin-reg-alert','');
  if(!owner||!phone||!type||!carname){ setAlert('admin-reg-alert','Complet√°: propietario, tel√©fono, tipo y marca.'); shake('admin-reg-section'); return; }
  const btn=document.getElementById('a-submit-btn'); btn.disabled=true; btn.innerHTML='<span class="spinner"></span>Registrando‚Ä¶';
  await delay(700);
  db.vehicles.push({ id:Date.now().toString(), owner, phone, type, carname, model, km:document.getElementById('a-km').value, entry:document.getElementById('a-entry').value, exit:document.getElementById('a-exit').value, problem:document.getElementById('a-problem').value.trim(), cost:document.getElementById('a-cost').value, status:document.getElementById('a-status').value, source:'admin' });
  save();
  btn.disabled=false; btn.innerHTML='Registrar veh√≠culo ‚úì';
  setAlert('admin-reg-alert','Veh√≠culo registrado exitosamente.','success');
  ['a-owner','a-phone','a-km','a-exit','a-problem','a-cost'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('a-carname').value=''; document.getElementById('a-model').value=''; document.getElementById('a-status').value='Pendiente';
  document.querySelectorAll('#a-type-cards .vehicle-card').forEach(c=>{ c.classList.remove('selected'); const ic=c.querySelector('div'); if(ic) ic.style.color='var(--muted)'; const lb=c.querySelectorAll('div')[1]; if(lb) lb.style.color='var(--muted)'; });
  selType.a='';
  renderStats(); renderBilling(); renderTable(); showToast('Veh√≠culo agregado al sistema.');
  setTimeout(()=>setAlert('admin-reg-alert',''),3500);
}

// ‚îÄ‚îÄ EDIT ‚îÄ‚îÄ
function openEditById(id){
  const v=db.vehicles.find(x=>x.id===id); if(!v) return;
  populateSelects([['e-carname','e-model']]);
  document.getElementById('edit-id').value=id;
  document.getElementById('e-owner').value=v.owner;
  document.getElementById('e-phone').value=v.phone||'';
  document.getElementById('e-km').value=v.km||'';
  document.getElementById('e-entry').value=v.entry||'';
  document.getElementById('e-exit').value=v.exit||'';
  document.getElementById('e-problem').value=v.problem||'';
  document.getElementById('e-cost').value=v.cost||'';
  document.getElementById('e-carname').value=v.carname||'';
  document.getElementById('e-model').value=v.model||'';
  document.getElementById('e-status').value=v.status||'Pendiente';
  selType.e=v.type||'';
  document.querySelectorAll('#e-type-cards .vehicle-card').forEach(c=>{ const sel=c.dataset.type===v.type; c.classList.toggle('selected',sel); const ic=c.querySelector('div'); if(ic) ic.style.color=sel?'var(--accent)':'var(--muted)'; const lb=c.querySelectorAll('div')[1]; if(lb) lb.style.color=sel?'var(--text)':'var(--muted)'; });
  updateEditPills(); show('edit-modal');
}

function updateEditPills(){
  const km=document.getElementById('e-km').value, cost=document.getElementById('e-cost').value;
  document.getElementById('edit-pills').innerHTML=`
    <div class="metric-pill"><div class="lbl">Kilometraje</div><div class="num">${km?Number(km).toLocaleString('es-AR')+' km':'Sin registrar'}</div></div>
    <div class="metric-pill gold"><div class="lbl">Monto (ARS)</div><div class="num">${cost?formatARS(cost):'Sin registrar'}</div></div>`;
}

function closeModal(){ hide('edit-modal'); }

function saveEdit(){
  const id=document.getElementById('edit-id').value, idx=db.vehicles.findIndex(x=>x.id===id); if(idx===-1) return;
  db.vehicles[idx]={ ...db.vehicles[idx], owner:document.getElementById('e-owner').value.trim(), phone:document.getElementById('e-phone').value.trim(), type:selType.e||db.vehicles[idx].type, carname:document.getElementById('e-carname').value, model:document.getElementById('e-model').value, km:document.getElementById('e-km').value, cost:document.getElementById('e-cost').value, entry:document.getElementById('e-entry').value, exit:document.getElementById('e-exit').value, problem:document.getElementById('e-problem').value.trim(), status:document.getElementById('e-status').value };
  save(); closeModal(); renderStats(); renderBilling(); renderTable(); showToast('Cambios guardados correctamente.');
}

function deleteVehicle(){
  if(!confirm('¬øElimin√°s este registro?')) return;
  const id=document.getElementById('edit-id').value;
  db.vehicles=db.vehicles.filter(v=>v.id!==id);
  save(); closeModal(); renderStats(); renderBilling(); renderTable(); showToast('Registro eliminado del sistema.');
}

document.getElementById('edit-modal').addEventListener('click',function(e){ if(e.target===this) closeModal(); });
</script>
</body>
</html>
